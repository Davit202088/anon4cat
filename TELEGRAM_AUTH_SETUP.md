# Настройка Telegram аутентификации

## Шаг 1: Создание Telegram бота

1. Откройте Telegram и найдите @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный **BOT_TOKEN** (выглядит как `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

## Шаг 2: Настройка Web App

1. В чате с @BotFather отправьте команду `/mybots`
2. Выберите вашего бота
3. Выберите "Bot Settings" → "Menu Button"
4. Настройте ссылку на ваше приложение (например, `https://yourdomain.com`)

## Шаг 3: Настройка переменных окружения

1. Создайте файл `.env` в корне проекта:
```bash
cp .env.example .env
```

2. Откройте `.env` и заполните:
```env
BOT_TOKEN=ваш_токен_от_BotFather
ADMIN_IDS=ваш_telegram_id,другой_admin_id
PORT=3000
```

**Как узнать свой Telegram ID:**
- Напишите боту @userinfobot
- Он отправит вам ваш ID

## Шаг 4: Запуск приложения

```bash
npm install
npm start
```

## Шаг 5: Тестирование

1. Откройте Telegram
2. Найдите вашего бота
3. Нажмите на кнопку Menu (должна открыться ваша Web App)
4. При первом входе пользователь автоматически зарегистрируется в системе

## Структура пользователя

После успешной аутентификации в базе данных создается пользователь со следующими полями:

- `userId` - Telegram ID пользователя
- `username` - username из Telegram
- `firstName` - имя пользователя
- `lastName` - фамилия пользователя
- `role` - роль (user/admin)
- `premiumStatus` - статус подписки (free/premium)

## Админ-панель

Пользователи с ID из `ADMIN_IDS` получат:
- Доступ к админ-панели
- Возможность управлять пользователями
- Возможность выдавать/забирать Premium статус
- Возможность назначать других админов

## Fallback режим (для тестирования без Telegram)

Если приложение открыто вне Telegram Web App:
- Показывается форма входа
- Можно ввести любой ID для тестирования
- Функционал работает так же, как и с настоящей аутентификацией

## Безопасность

⚠️ **Важно:**
- Никогда не публикуйте `.env` файл в репозитории
- `BOT_TOKEN` должен оставаться секретным
- В продакшене используйте HTTPS
- Настройте reverse proxy (Nginx) для SSL

## Проблемы и решения

### "BOT_TOKEN not set" warning
- Убедитесь, что файл `.env` существует
- Проверьте, что переменная `BOT_TOKEN` заполнена
- Перезапустите сервер после изменения `.env`

### Пользователь не может войти
- Проверьте, что Web App правильно настроен в @BotFather
- Откройте консоль браузера и проверьте ошибки
- Убедитесь, что сервер запущен и доступен

### Админ-панель не отображается
- Проверьте, что ваш Telegram ID добавлен в `ADMIN_IDS`
- ID должен быть точно таким, как показывает @userinfobot
- Перезапустите сервер после изменения `.env`
